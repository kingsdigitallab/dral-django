{% extends "dral_wagtail/visualisation_page.html" %}

{% block visualisation %}
        <h3>LT</h3>
        <svg class="calendar LT">
        </svg>
        <h3>RU</h3>
        <svg class="calendar RU">
        </svg>
        <h3>POL</h3>
        <svg class="calendar POL">
        </svg>

{% endblock %}

{% block footer_scripts %}
    {{ block.super }}

    {# D3Js Library - Link to ext file for now #}
    <script src="https://d3js.org/d3.v5.min.js"></script>

    <script>
        $(function() {
            
            window.vis_data = {{ vis_data|safe }};
            console.log(vis_data);

            $.each(window.vis_data, function(lang, data) {
                console.log(this);

                var width = 0;
                var graph = d3.select('.calendar.' + lang)
                    .append('g')
                    .attr('class', lang);

                console.log(this.length);

                var width_increment = 20;

                var y = 0;
                var counter = 0;

                $.each(data, function(i, d) {
                    var height = d.ratio_omitted * 100;

                    if (d.ratio_omitted == 1) {
                      var rectangles = d3.select('g.' + lang)
                        .append('rect')
                        .attr('class', 'square omitted')
                        .attr('height', '20px')
                        .attr('width', '20px')
                        .attr('x', width)
                        .attr('y', y)
                        // To display aligned at the bottom:
                        // .attr('y', 500 - height)
                        .attr('fill-opacity', d.ratio_omitted)
                        .text(d.ratio_omitted);

                        width += width_increment;
                        counter++;

                        if (counter == 100) {
                          y += 20;
                          counter = 0;
                          width = 0;
                        }

                    } else {
                      var rectangles = d3.select('g.' + lang)
                        .append('rect')
                        .attr('class', 'square')
                        .attr('height', '20px')
                        .attr('width', '20px')
                        .attr('x', width)
                        .attr('y', y)
                        // To display aligned at the bottom:
                        // .attr('y', 500 - height)
                        .attr('fill-opacity', d.ratio_omitted)
                        .text(d.ratio_omitted);

                        width += width_increment;
                        counter++;

                        if (counter == 100) {
                          y += 20;
                          counter = 0;
                          width = 0;
                        }
                    }
                });

                console.log(width);
            });
        });
    </script>
{% endblock %}